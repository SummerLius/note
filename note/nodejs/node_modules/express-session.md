```javascript
var session = require('express-session');
var RedisStore = require('connect-redis')(session);

app.use(session(options));
```

- options
    - cookie
        - cookie.expires
        - cookie.httpOnly
        - cookie.maxAge
        - cookie.path
        - cookie.sameSite
        - cookie.secure
    - genid
    - name
    - proxy
    - resave
    - rolling
    - saveUninitialized
    - secret
    - store
    - unset


### 中间件逻辑

大致流程：
1. 来了一个请求，然后express-session中间件给req添加属性req.session
2. 请求结束时，将req.session内容持久化到redis，并设置res.setHeader('cookie')





























```javascript
function(options) {


    store.generate = function(req) {
        req.sessionID = generateId(req);
        res.session = new Session(req);
        req.session.cookie = new Cookie(cookieOptions);

        if (cookieOptions.secure === 'auto') {
            req.session.cookie.secure = issecure(req, trustProxy);
        }
    }

    return function session(req, res, next) {
        
        req.sessionStore = store;

        var cookieId = req.sessionID = getcookie(req, name, secrets);

        onHeaders(res, function(){});

        req.end = function end(chunk, encoding) {}

        function generate() {
            store.generate(req);
            originalId = req.sessionID;
            originalHash = hash(req.session);
            wrapmethods(req.session);
        } 

        // wrap session methods
        function wrapmethods(sess) {}

        // check if session has been modified
        function isModified(sess) {}

        // check if session has been saved
        function isSaved(sess) {}

        // determine if session should be destroyed
        function shouldDestroy(req) {}

        // determine if session should be saved to store
        function shouldSave(req) {}

        // determine if session should be touched
        function shouldTouch(req) {}

        // determine if cookie should be set on response
        function shouldSetCookie(req) {}

        // generate a session if the browser doesn't send a sessionID
        if (!req.sessionID) {
            debug('no SID sent, generating session');
            generate();
            next();
            return;
        }

        store.get(req.sessionID, function(err, sess){});
    }
}
```





