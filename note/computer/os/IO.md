
<!-- TOC -->

- [I/O系统](#io系统)
    - [数据传送方式](#数据传送方式)
        - [程序控制方式](#程序控制方式)
        - [程序中断方式](#程序中断方式)
        - [直接存储器存取方式（DMA）](#直接存储器存取方式dma)
- [IO软件库接口](#io软件库接口)
- [IO之网络](#io之网络)
- [参考](#参考)

<!-- /TOC -->

## I/O系统

输入/输出（I/O）是在cpu、主存和外部设备（例如磁盘、终端、网络等）之间传输数据的过程。

- Input: Input Device --> RAM
- Output: Output Device <-- RAM

<!-- 传输数据的方式有：
- 程序控制
    - 无条件传送方式
    - 有条件传送方式
- 程序中断
- 直接存储器DMA -->

### 数据传送方式

传输的方式不同，cpu对外设的控制方法也不同，从而使接口电路的结构及功能也不同，cpu与外设的接口的连接方法也不同。

#### 程序控制方式

程序控制传送方式，顾名思义即编程可控制，在程序中利用**I/O指令**来完成CPU与io接口交换信息的一种方式。何时进行这种信息传送是事先知道的，所以能把I/O指令插入到程序中所需要的位置。

根据外设性质不同，可以细化为：无条件传送和有条件传送

**无条件传送**

微机系统中一些简单的外设，如开关、继电器、数码管等，他们在工作时，可以认为输入设备已随时准备好向CPU提供数据，而输出设备也随时准备好接受CPU送来的数据，这样，在CPU需要同外设交换信息时，就能够用 IN 或 OUT 指令直接对这些外设进行输入/输出操作。

> CPU为主导，外设被动，CPU主动执行IN/OUT指令来进行I/O操作 

由于在这种方式下CPU对外设进行输入/输出操作时**无需考虑外设的状态**，故称为为条件传送方式。


**有条件传送（查询传送）**

查询传送也称为条件传送，是指在执行输入指令（IN）或输出指令（OUT）前，**要先查询相应设备的状态**，当输入设备处理准备好的状态，输出设备处理空闲状态时，CPU才执行IN/OUT指令与外设交换信息。为此，接口电路中既要有数据端口，还要状态端口。

查询方式完成一次数据传送经历：
1. CPU从接口中读取状态字
2. CPU检测相应的状态位是否满足"就绪"条件
3. 若就绪，则进行数据传送，否者重复1、2步

查询传送的主要优点是保证主机和外设之间协调同步的工作，且硬件线路比较简单，程序也容易实现。但是在这种方式下，CPU花费了较多时间查询外设是否准备就绪；此外，在实时控制系统中，由于一个外设的I/O操作为处理完毕就不能处理下一个I/O操作，故不能达到实时的要求。

因此，查询传送方式有两个突出的缺点：**浪费CPU时间，实时性差**。所以，查询传送方式适用于数据I/O操作不太频繁且外设较少、对实时要求不高的情况。

> 不论是无条件传送方式还是查询传送方式，都不能发现和处理预先无法估计的错误和异常情况。为了提高CPU的效率、增加系统的实时性，并且能对随机出现的各种异常情况做出即使反映，通常常用中断方式。

#### 程序中断方式

中断（Interrupt）传送方式指当外设需要与CPU进行信息交换时，由外设主动向CPU发出请求信号，使CPU暂停正在执行的程序，转去执行数据的I/O操作，数据传送结束后，CPU再继续执行被暂停的程序。

>查询传送方式由CPU来查询外设的状态，CPU主动，外设被动；中断传送方式由外设主动向CPU发出请求，外设主动，CPU被动。

- 优点：CPU不必查询等待，工作效率高，CPU与外设可以并行工作；实时性比程序控制的输入/输出要好的多。
- 缺点：
    - 为了能接受中断请求信号，CPU内部要提供一些线路来控制；
    - 利用中断I/O，每传送一次数据就要中断一次CPU。CPU响应中断后，每次都要执行"中断处理程序"，而且其中都要保护现场、恢复现场，这相当麻烦，浪费了很多不必要的CPU时间。
    
故此种传送方式一般较适合于传送少量的输入/输出数据。对于大量的输入/输出数据可采用高速的直接存储器存储方式DMA。

> 目前处理器都具有中断功能，而且已经不局限于数据的输入/输出，还可以传输其它信息，用于控制、故障处理等。


#### 直接存储器存取方式（DMA）

DMA（Direct Memory Access）传送方式是在存储器和外设之间、存储器和存储器之间直接进行数据传送。传输过程无需CPU介入，这样在传送时不必进行保护现场等一系列额外操作，传输的速度基本取决于存储器和外设的速度。

DMA传送方式需要一个专用接口芯片DMA控制器（DMAC）对传送过程控制和管理。在进行DMA传送期间，CPU放弃总线控制权，将系统总线交给DMAC控制，由DMAC发出地址及读/写信号来实现高速数据传输。传送结束后DMAC再将总线控制权交还给CPU。一般处理器都设有用于DMA传送的联络线。

<!-- I/O设备一般由机械部件和电子部件组成。电子部件称作设备控制器（device controller）或适配器（adapter）。 -->

## IO软件库接口


> 作者：严肃
> 链接：https://www.zhihu.com/question/19732473/answer/20851256  
> 来源：知乎  
> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。  
>
>“阻塞”与"非阻塞"与"同步"与“异步"不能简单的从字面理解，提供一个从分布式系统角度的回答。  
> 1. 同步与异步关注的是消息通信机制 (synchronous communication/ asynchronous communication)所谓同步，就是在发出一个*调用*时，在没有得到结果之前，该*调用*就不返回。但是一旦调用返回，就得到返回值了。换句话说，就是由*调用者*主动等待这个*调用*的结果。而异步则是相反，*调用*在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在*调用*发出后，*被调用者*通过状态、通知来通知调用者，或通过回调函数处理这个调用。典型的异步编程模型比如Node.js举个通俗的例子：你打电话问书店老板有没有《分布式系统》这本书，如果是同步通信机制，书店老板会说，你稍等，”我查一下"，然后开始查啊查，等查好了（可能是5秒，也可能是一天）告诉你结果（返回结果）。而异步通信机制，书店老板直接告诉你我查一下啊，查好了打电话给你，然后直接挂电话了（不返回结果）。然后查好了，他会主动打电话给你。在这里老板通过“回电”这种方式来回调。  
>       - 即，同步、异步概念对象是：方法、函数等
>2. 阻塞与非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。还是上面的例子，你打电话问书店老板有没有《分布式系统》这本书，你如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果，如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了， 当然你也要偶尔过几分钟check一下老板有没有返回结果。在这里阻塞与非阻塞与是否同步异步无关。跟老板通过什么方式回答你结果无关。如果是关心blocking IO/ asynchronous IO, 参考  Unix Network Programming View Book
>       - 即，阻塞、非阻塞概念对象是：线程、进程
>3. 两者概念是由关联的，例如**同步方法**一般会导致**线程阻塞**

软件中的同步、异步，主要指的是同步函数调用、异步函数调用：
- 同步调用：调用者想要的结果，必须通过函数返回（调用者主动等待结果返回）
- 异步调用：调用者想要的结果，不是通过函数返回，而是通过其它途径，例如额外的事件循环线程、消息通知等手段（调用者被动通知结果返回）

## IO之网络

## 参考

- https://www.zhihu.com/question/28594409
- https://blog.csdn.net/wwe4023/article/details/72601174
- https://segmentfault.com/a/1190000003063859


