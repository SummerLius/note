<!-- TOC -->

- [网络层](#网络层)
    - [///////////////////////// 计算机网络 第六版 谢希仁 //////////////////////////////](#-计算机网络-第六版-谢希仁-)
    - [///////////////////////// 计算机网络 自顶向下方法 第六版 //////////////////////////////](#-计算机网络-自顶向下方法-第六版-)
    - [///////////////////////// TCP/IP协议卷 //////////////////////////////](#-tcpip协议卷-)
    - [///////////////////////// 以下待整理 //////////////////////////////](#-以下待整理-)
    - [网络层提供的服务](#网络层提供的服务)
    - [IP地址](#ip地址)
        - [IP地址](#ip地址-1)
            - [分类的IP地址](#分类的ip地址)
            - [划分子网](#划分子网)
            - [无分类编址CIDR](#无分类编址cidr)
        - [网际控制报文协议ICMP](#网际控制报文协议icmp)
            - [构造超网](#构造超网)
        - [ARP协议](#arp协议)
        - [分组转发](#分组转发)
    - [待处理1](#待处理1)
        - [IP分配](#ip分配)
    - [待处理2-自顶向下网络层章节](#待处理2-自顶向下网络层章节)
        - [网络层功能和服务](#网络层功能和服务)
        - [转发](#转发)
        - [路由选择](#路由选择)

<!-- /TOC -->

# 网络层

网络层交换的信息称为：datagram，数据报。

网络层主要讨论网络互联方面的问题，即多个网络通过路由器互连成为一个**互连网络**（或**互联网**）方面的问题。


> **是时候整理一下，这个网络层的知识了**

<br/>


## ///////////////////////// 计算机网络 第六版 谢希仁 //////////////////////////////

## ///////////////////////// 计算机网络 自顶向下方法 第六版 //////////////////////////////

## ///////////////////////// TCP/IP协议卷 //////////////////////////////













## ///////////////////////// 以下待整理 //////////////////////////////

## 网络层提供的服务

- 网络层向上提供简单灵活的、无连接的、尽最大努力交付的数据报服务。
- 网络层不提供服务质量的承诺。

## IP地址

整个因特网是一个单一的、抽象的网络。IP地址就是给因特网上的每一个主机或路由器分配一个在全世界范围内唯一的32位的标识符。

IP地址有ICANN机构分配。

IP地址编址方法共经过了三个历史阶段：
1. `分类的IP地址`：这是最基本最开始的编址方法，在1981年通过相应的标准协议
2. `子网的划分`：对"分类的IP地址"编址方法的改进，其标准rfc 950在1985年通过
3. `构成超网`：这是比较新的无分类编址方法，1993年提出后很快得到推广应用

### IP地址

#### 分类的IP地址
分为网络号和主机号，这种两级的IP地址记为：

IP地址 ::= {<网络号>,<主机号>}

A B C D E

#### 划分子网

IP地址 ::= {<网络号>, <子网号>, <主机号>}

将IP的主机部分划出一部分当作子网的网络号。

英特网标准规定：所有网络必须使用子网掩码。

子网掩码是一个网络或一个子网的重要属性。在RFC 950称为英特网的正式标准后，路由器在和相邻的路由器交换路由信息时，必须把自己所在网络或子网的子网掩码告诉相邻的路由器。

在路由器的路由表的每一个项目，除了要给出目的的网络地址外，还必须同时给出该网络的子网掩码。

#### 无分类编址CIDR

### 网际控制报文协议ICMP

ICMP报文的两种类型：
- ICMP差错报告报文
- ICMP询问报文






#### 构造超网


### ARP协议

已经知道了一个机器的IP地址，需要找出相应的硬件地址，地址解析协议ARP就是解决这样的问题。

ARP解决这个问题的方法是在主机ARP高速缓存中存放一个从IP地址到硬件地址的映射表，并且这个映射表还经常动态更新。

ARP是解决同一局域网上的主机或路由器的IP地址和硬件地址的映射问题。如果目的地主机在其它网络上，则解析路由器的硬件地址，将数据发给路由器，由路由器转发出去。

IP地址到硬件地址的解析是操纵系统自动进行的，主机的用户对这种地址解析的过程是不知道的。

### 分组转发








## 待处理1

<!-- - ip/domain/通用顶级域名、国家及地区顶级域名系统管理，根服务器系统管理 -->

组织：
- isp
- icann
    - interNIC
    - iana
        - apnic
            - cnnic



业务：
- ip分配
- 域名注册
- dns服务器管理
- 协议管理等
- ...


分配查找情况：
- iana机构ip地址和as号分配情况：
    - https://www.iana.org/numbers
        - https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xml
        - https://www.iana.org/assignments/as-numbers/as-numbers.xhtml
- apnic的分配情况：http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest
- 较好的whois工具，mac或linux上可以安装一个whois工具，"apt-get install whosis"，此工具可以查找任意ip


### IP分配

目标：
- 阐述一次网络请求的完整过程
- 该过程中各个资源的管理


用户电脑ip地址通过因特网服务商分配（isp），isp可以通过本地英特网注册机构（LIR）或国家英特网注册机构（NIR），或所属的区域注册机构（RIR）获得IP地址的分配。

全世界有5个RIR：
- `AFRINIC`：Africa Region
- `APNIC`：Asia/Pacific Region
- `ARIN`：Canada, USA, and some Caribbean Islands
- `LACNIC`：Latin America and some Caribbean Islands
- `RIPE NCC`：Europe, the Middle East, and Central Asia

顶级ip资源管理机构IANA只和RIR交流，IANA将未分配的ip池给RIR机构去分配各个区域的ip。


例如APNIC机构，负责亚太区域的IP地址的分配、管理。

我国的CNNIC机构是APNIC的会员，代表中国的NIR机构，负责为国内的互联网用户提供IP地址本地化分配服务。

当然作为用户，我们既可以向APNIC申请IP地址、也可以向CNNIC申请IP地址。


现在我们可以通过机构申请到一个独一无二的ip地址，那么接下来的问题是：

> isp扮演的角色，单个用户或公司单位是向isp申请ip还是向nir、rir申请ip？

首先isp拥有什么
- 向lir或nir或rir申请的批量ip地址
- 拥有网络（通信链路和路由器等通信设备）

所有一般情况下，都是用户或单位向isp申请并接入isp网络

> 用户电脑拿到申请的ip后怎么使用呢？用户电脑发出的ip数据报中的指定的source ip即自己申请的ip，如何证明这确实是自身向权威机构申请的ip而不是随便捏造的？

> 不同国家之间如何如何进行网络通信？

不同国家之间有通过**光缆**直连的，也有通过其它国家路由中转的。

例如中国和美国，通过修建海底光缆直连。

如果没有直连的线路，则通过其它国家路由中转， 例如国家A、B、C，A和B直连，B和C直连，那么A想访问C中的服务器，那么可以通过B中转。

如果连中转都没有，那就无法访问了，只能说明，两者不在同一网络中。

> isp的接入方式有那些？

网络中的端系统有PC、智能手机、服务器等，这些端系统可以接入ISP与Internet相连。

接入的技术方式有：
- DSL
- 电缆
- FTTH、光缆
- WIFI
- 蜂窝
- ...

> "网络的网络" 演化？

构成Internet的“网络的网络”已经演化成一个非常复杂的结构，这种演化大部分是由经济和国家策略驱动的，而不是由性能考虑驱动的。

<!-- http://tech.sina.com.cn/i/2005-07-19/1038666886.shtml
http://www.wenku1.com/news/4815CE9A9D99ECEB.html
https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E9%AA%A8%E5%B9%B2%E7%BD%91%E8%BF%90%E8%90%A5%E5%95%86 -->



## 待处理2-自顶向下网络层章节

网络层功能：
- 转发（forwarding）：转发涉及分组在单一的路由器从一条入链路到一条出链路的传送
- 路由（routing）：路由选择涉及一个网络的所有路由器，他们经过路由选择协议共同交互，以决定分组从源到目的地节点所采用的路径。


### 网络层功能和服务

- 转发：指将分组从一个输入链路接口转入到适当的输出链路接口的路由器本地动作
- 路由选择：指网路范围的过程，以决定分组从源到目的地所采取的端到端的路径。

### 转发

### 路由选择
