<!-- TOC -->

- [sed](#sed)
    - [概要](#概要)
    - [运行sed](#运行sed)
        - [选项参数](#选项参数)
    - [脚本](#脚本)
        - [sed脚本概述](#sed脚本概述)
        - [sed脚本命令汇总](#sed脚本命令汇总)
        - [命令：s](#命令s)
        - [常用命令](#常用命令)
    - [地址：选择行](#地址选择行)
    - [正则表达式：选择文本](#正则表达式选择文本)
    - [高级特性：循环和缓存空间](#高级特性循环和缓存空间)
    - [一些实例](#一些实例)
    - [临时](#临时)
    - [参考链接](#参考链接)

<!-- /TOC -->

# sed

## 概要

> Linux 文本三剑客之一
>   - awk，侧重文本分析、处理
>   - sed，侧重文本编辑
>   - grep，侧重文本搜索、过滤


- [GNU sed文档](https://www.gnu.org/software/sed/manual/sed.html)
- 应用：
    - 文本替换
    - 选择性的输出文本文件
    - 从文本文件的某处开始编辑
    - 无交互式的对文本文件进行编辑等
    - ...
- 简介：
    - sed 是一种流编辑器，它是文本处理中非常中的工具，能够完美的配合正则表达式使用，功能不同凡响。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。
- 命令格式：
    - sed通过指定的script来处理文本
    - `sed [option] [input-file|stdin]`
    - `sed [-hnVi] [-e<script>][-f<script文件>] [文本文件]`
- **注意**
    - NOTE：如果选项 `-e 或 --expression`，`-f 或 --file` 没有指定，那么第一个非选项参数将会被sed当做脚本script去执行。剩下的参数作为输入文件名，如果没有指定输入文件，那么将sed将会从标准输入stdin读取数据。
- sed工作流
    - sed遵循的工作流：读取，执行，显示
        - 读取：sed从输入流（文件、管道、标准输入）中读取一行并且存储到它叫做 模式空间（pattern buffer）的内部缓存区
        - 执行：默认情况下，所有的sed命令都在模式空间中顺序的执行，除非指定了行的地址，否则sed命令会在所有的行上依次执行
        - 显示：发送修改后的内容到输出流。在发送数据后，模式空间将会被清空
    - 在所有文件的内容被处理完成之前，上述过程将会重复执行。
- 其他：
    - 模式空间 （pattern buffer） 是一块活跃的缓冲区，在sed编辑器执行命令时它会保存待检查的文本
    - 默认情况下，所有的SED命令都是在模式空间中执行，因此输入文件并不会发生改变
    - 还有另外一个缓冲区叫做 保持空间 （hold buffer），在处理模式空间中的某些行时，可以用保持空间来临时保存一些行。在每一个循环结束的时候，SED将会移除模式空间中的内容，但是该缓冲区中的内容在所有的循环过程中是持久存储的。SED命令无法直接在该缓冲区中执行，因此SED允许数据在 保持空间 和 模式空间之间切换
    - 初始情况下，保持空间 和 模式空间 这两个缓冲区都是空的
    - 如果没有提供输入文件的话，SED将会从标准输入接收请求
    - 如果没有提供地址范围的话，默认情况下SED将会对所有的行进行操作


## 运行sed

### 选项参数

- `-e script`
- `--expression=script`：
    - 指定script来让sed处理文本
- `-f script_file`
- `--file=script_file`
    - 指定script文件来让sed处理文本
- `-n`
- `--quiet`
- `--silent`
    - 仅显示script处理后的结果，中间处理不输出
- `-i[SUFFIX]`
- `--in-place[=SUFFIX]`
    - 直接修改至读取的文件，而不是输出到stdout。（默认是输出到stdout）。如果提供了suffix，将会备份原文件，否则将直接覆盖原文件。
- `-h`
- `--version`

## 脚本

### sed脚本概述
### sed脚本命令汇总
### 命令：s
### 常用命令


## 地址：选择行

## 正则表达式：选择文本

## 高级特性：循环和缓存空间

## 一些实例



## 临时

```sh
# 单引号里面内容就是script，用来具体说明如何操作文本文件

# 注意如果使用引号的话，使用单引号，不要使用双引号

sed -n -e '1,$p' file.txt
```

**参数说明**：
- -e
- -f
- -e
- -n
- -i
- -h
- -V

**动作说明**：
- a
- c
- s
- i
- d
- p

如果没有指定 `-n，-f`选项，那么sed指令将第一个非选项参数当作script内容去解释，即 `-n，-f` 可以省略，其余的参数当作文本文件的name，如果没有指定文本文件，那么从标准输入stdin读取文本内容。



脚本语法：`[Address] [!] <command>`   

**Address**：

sed指令可以不指定地址，在这种情况下，脚本里的操作会应用所有行。

指定了单行地址，则sed只会匹配此行进行操作。

指定了两个地址，则sed会匹配这两个地址内的范围所有行。

## 参考链接

- http://blog.jobbole.com/109088/
- http://man.linuxde.net/sed
- https://www.gnu.org/software/sed/manual/
- https://blog.csdn.net/xj626852095/article/details/26101273
- http://blog.jobbole.com/109088/
