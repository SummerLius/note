<!-- TOC -->

- [CSS](#css)
    - [概述](#概述)
    - [语法](#语法)
        - [@规则](#规则)
        - [选择器](#选择器)
            - [选择器分组](#选择器分组)
            - [元素选择器](#元素选择器)
            - [类选择器](#类选择器)
            - [ID选择器](#id选择器)
            - [通配选择器](#通配选择器)
            - [属性选择器](#属性选择器)
            - [相邻兄弟选择器](#相邻兄弟选择器)
            - [普通兄弟选择器](#普通兄弟选择器)
            - [子选择器](#子选择器)
            - [后代选择器](#后代选择器)
            - [伪类 Pseudo-class](#伪类-pseudo-class)
            - [伪元素 Pseudo-elements](#伪元素-pseudo-elements)
    - [结构和层叠](#结构和层叠)
        - [特殊性](#特殊性)
        - [继承](#继承)
        - [层叠](#层叠)
    - [参考](#参考)

<!-- /TOC -->

# CSS

## 概述

- CSS指层叠样式表（Cascading Style Sheets）
- 作用：样式决定如何显示HTML元素
- 样式除了在样式表css中定义外，还可以在html文档内定义
- 把样式从html抽离出来定义，是为了将**内容和表现分离，从而提高工作效率**


样式层叠次序，优先级由低到高：
1. 浏览器缺省设置
2. 外部样式表
3. 内部样式表（位于head标签内部）
4. 内联样式（HTML元素内部）

## 语法

- **CSS规则**：
    - CSS规则由两个主要部分构成：**选择器**，**声明**
    - 一对选择器与声明块称为规则集（ruleset），简称为规则（rule）。
    - 一个元素Element可能被多个选择器选中，因此会有多个规则，有可能以不同的值去设置同一属性。CSS标准会规定优先级最高的那个生效，称之为 **层叠 cascade** 算法。
- **CSS语句**：
    - 规则是样式表的主体，通常样式表会包括大量的规则列表。
    - 除了规则语句外，还包括一些其它信息语句，用于设置字符集、引入其它外部样式表、引入字体等等
    - 语句类型：
        1. 规则。即选择器和声明对。
        2. at规则。以`@`开始，随后是标识符，一直到分号`;`或右大括号`}`结束。每个at规则由其标识符定义，可能有它自己的语法。at规则涵盖了meta信息（如@charset @import），条件信息（如 @media @document），描述信息（@font-face）。
        3. 不是上面类型的语句则是非法，被忽略
    - 条件规则组（conditional group rules）是特殊的at规则，可以嵌套语句。
- **注释**：
    - `/* xxx */`
- **选择器**：
    - 作用：选择HTML元素
- **声明**：
    - 构成：每条声明由一个属性和一个值组成
    - 属性：样式属性（style attribute）
    - 值：每个属性对应值
    - 属性和值被冒号分开
    - 格式：`h1 {color:red; font-size:14px;}`






### @规则

一个@规则是一个CSS语句，以`@`符号开头，后跟一个标识符，并包括到下一个分号`;`或右大括号`}`。

下面是一些@规则，由它们的标识符指定，每种规则都有不同的语法：
- `@charset`：定义样式表使用的字符集
- `@import`：告诉CSS引擎引入一个外部样式表
- `@namespace`：告诉CSS引擎必须考虑XML命名空间
- 嵌套@规则，是嵌套语句的子集，不仅可以作为样式表里的一个语句，也可以用在条件规则组里：
    - `@media`：如果满足媒介查询条件则条件规则组里的规则生效
    - `@page`：描述打印文档时布局的变化
    - `@font-face`：描述将下载的外部的字体
    - `@keyframes`：描述CSS动画的中间步骤
    - `@supports`：如果满足给定条件规则，条件规则组里的规则生效
    - `@document`：如果文档样式表满足给定条件规则，条件规则组里的规则生效（推延至CSS4 规范）
- [详情见MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/At-rule)



条件规则组：
- 有一些@规则可以归为一类：**条件规则组**
- 这些语句使用相同的语法，都嵌套语句，或者是规则或@规则
- 条件规则组作用：它们所指的条件总等于true或false，如果为true，那么它们里面的语句生效。
- 条件规则组由**CSS3**定义：
    - `@media`
    - `@supports`
    - `@document`：（推延至CSS4规范）

### 选择器

- 基本选择器
    - 元素选择器
    - 类选择器
    - ID选择器
    - 通配选择器
    - 属性选择器
- 组合选择器
    - 相邻兄弟选择器：`+`
    - 普通兄弟选择器：`~`
    - 子选择器：`>`
    - 后代选择器：`_`
- 伪类
- 伪元素

#### 选择器分组

同时指定多个选择器对应同一个声明块

```css
p,div {xxx;}
```

#### 元素选择器

通过node节点名称匹配元素

语法：`元素 { 样式声明 }`

```css
span {
    color: #ffffff
}
```

#### 类选择器

使用 `.` 符号，类选择器会根据**元素的类属性中的内容匹配元素**。

可以指定元素名使用class组合使用，可以多个class组合使用。

语法：`.类名 { 样式声明 }`、`元素名.类名 { 样式声明}`、`.类名.类名 {}`

> 注意class名第一个字符不能使用数字，它无法在mozilla和firefox中起作用

```css
.myclass {xxx;}

span.myclass {xxx;}

.myclass1.myclass2 {xxx;}
```

#### ID选择器

匹配元素ID属性

语法：`#id属性 { 样式声明 }`

```css
#myid {xxx;}

div#sidebar {xxx;}

p#main[href] {xxx;}
```

#### 通配选择器

星号（\*）是通配选择器，它可以匹配任意类型的HTML元素。通配符号可以和其它选择器组合。

在CSS3中，星号可以和命名空间组合使用：
- xx
- xx
- xx

```css
*#myid {xxx;}
*.warning {xxx;}
```

#### 属性选择器

属性选择器通过元素**属性名**或**属性值**匹配元素。

语法：
- `[attr]`
    - 匹配含有以attr命名的属性的元素
- `[attr=value]`
    - 匹配含有以attr命名的属性，且值为value的元素
- `[attr~=value]`
    - 匹配含有以attr命名的属性，并且该属性是一个以空格space作为分隔的值列表，其中至少含有一个值为value
- `[attr|=value]`
    - 匹配含有以attr命名的属性，且该属性值是以"value"或"value-"为开头的元素
- `[attr^=value]`
    - 匹配含有以attr命名的属性，且该属性值以value开头的元素
- `[attr$=value]`
    - 匹配含有以attr命名的属性，且该属性值以value结尾的元素
- `[attr*=value]`
    - 匹配含有以attr命名的属性，且该属性值含有value的元素
- `[attr operator value i]`
    - 在上述所有选择器中，可以添加一个字符 `i` ，表示可以忽略属性值大小写（ascii范围内字母）


```css
a[href] {xxx;}

a[href="https://www.duoyi.com"] { xxx; }

a[href^="https"] { xxx; }

a[href$="https" i] { xxx; }
```

#### 相邻兄弟选择器

也被称为相邻选择器，它只会匹配紧跟前方元素的同胞元素。（同胞元素：表示元素处于同一层次，有同一个父元素）

语法：`前方元素 + 目标元素 { 样式声明 }`

```css
li + li {
    color: red;
}
```

#### 普通兄弟选择器

在使用 `~` 连接两个元素的时候，它会匹配第二个元素，条件是它必须在第二个元素之后（不一定相邻），且他们都有同一个父元素（即同胞元素，处于同一层次）

语法：`元素 ~ 元素 { 样式声明 }`

```css
p ~ span {
    xxx;
}
```

#### 子选择器

使用 `>` 连接两个元素时，它只会匹配那些作为第一个元素直接后代（子元素）的第二元素。

语法：`父元素 > 子元素 { 样式声明 }`

```css
div > span { xxx; }
```

#### 后代选择器
 使用 `_`（空白字符，一个或多个空白字符）连接两个元素时，仅匹配祖先是第一个元素的第二个元素。

 后代选择器和子选择器比较相似，前者仅要求同祖同族，后者严格要求父子。

 语法：`祖先元素 后代元素 { 样式声明 }`

 ```css
 div span {xxx;}
 ```

#### 伪类 Pseudo-class

CSS伪类：是添加到选择器的关键字，指定元素的特殊状态。

**伪类和伪元素，它们允许你不仅仅根据文档DOM树中的内容（元素名、属性、dom树结构等）对元素应用样式，而且还允许你根据外部动态因素来应用样式，例如内容的状态、鼠标的位置等等。**

语法：`selector:pseudo-class {样式声明}`

详情见：
- [MDN 伪类参考](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Pseudo-classes)
- [MDN CSS参考](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference)


#### 伪元素 Pseudo-elements

伪元素同伪类相似，伪元素添加到选择器，但不描述特殊状态，它们允许你为元素的某些部分（或子元素）设置样式。

语法：`selector::pseudo-element { 样式声明 }`

- ::after
- ::before
- ::first-letter
- ::first-line
- ::selection
- ...
- [MDN CSS参考](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference)
- [MDN 伪元素参考](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Pseudo-elements)

## 结构和层叠

每个合法的HTML文档，都会生成一个结构树。有了这个结构树，选择器才能起作用，这也是CSS另外一个重要方面（继承）的核心。

继承，是从一个元素向其后代元素传递属性值所采用的机制。确定向一个元素具体应用那些样式时，用户代理不仅要考虑继承，还要考虑声明的特殊性，例外需要考虑声明本身的来源，这个过程就称为层叠（cascade）。

### 特殊性

对于每个规则（选择器+声明块），用户代理会计算选择器的特殊性，并将这个特殊性附加到规则中的各个声明。如果元素有两个或多个冲突的属性声明，那么有最高特殊性的声明就会胜出。

选择器特殊性规则如下：
1. ID属性值，加 0.1.0.0
2. 类属性值、属性选择或伪类，加 0.0.1.0
3. 元素或伪元素，加 0.0.0.1
4. 结合符和通配符，没有任何贡献

```css
h1 { color: red; } /* 0.0.0.1 */
p em { color: purple; } /* 0.0.0.2 */
.grape { color: purple; } /* 0.0.1.0 */
*.bright { color: yellow; } /* 0.0.0.1 */
p.bright em.dark { color: maroon; } /* 0.0.2.2 */
#id110 {  color: blue; } /* 0.1.0.0 */
div#sidebar *[href] { color: silver; } /* 0.1.1.1 */
```

- **声明和特殊性**
    - 一旦确定一个选择器的特殊性，这个值将会赋予对应每条相关声明
    - 对于每个CSS规则，由于特殊性的缘故，用户代理会将每个CSS规则 “解组” 为单独的规则，即将“分组选择器”和“声明块”解组为最小规则：单个选择器+单条声明
    - 若多个规则匹配同一个元素，且样式声明相互冲突时，特殊性则其作用

    ```css
    h1, h2.section { color: silver; background: black;}

    </* 用户代理解组 */>
    h1 { color: silver; }
    h1 { background: black; }
    h2.section { color: silver; }
    h2.section { background: black; }
    ```
- **通配选择器特殊性**
- **ID和属性选择器的特殊性**
    - ID特殊性 `#id`：0.1.0.0
    - 属性特殊性　`[id=id]`：0.0.1.0
- **内联样式特殊性**
    - 特殊性的第一位0，是为内联样式声明保留，它比所有其它声明的特殊性都高。
    - `<h1 style="color: green;">The head title</h1>`：1.0.0.0
- **重要性**
    - `!important`：使用重要标志的声明，不会添加特殊性值，用户代理不会将“重要性”和“特殊性”分为两类规则处理
    - 用户代理将声明分为：“重要声明” 和 “非重要声明” 两类处理
        - “重要声明”的特殊值冲突，会在重要声明内部处理
        - “非重要声明”的特殊值冲突，会在非重要声明内部处理
        - 若“重要声明”和“非重要声明”冲突，则总是“重要声明”胜出
    - 使用：`!important`总放在声明的最后，即分号的前面

### 继承

- 概念：
    - 基于继承机制，指定样式应用某元素，则样式不仅应用该元素，还可能会应用到它的后代元素。
- 继承是CSS最基本的内容，除非有必要的理由，否则一般不会特别考虑。
- 注意点：
    - 有些属性不能继承。例如，属性border就不能继承，其用于设置元素边框。如果border能继承，文档会变得更混乱，除非创作人员另外花功夫去掉继承的边框。
    - 一般的，大多数框模型属性都不能继承，例如xxxx


### 层叠

## 参考

- [MDN CSS参考](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference)
- [w3c CSS参考](http://www.w3school.com.cn/cssref/index.asp)
- 《css权威指南》
