## 存储器

## 存储器结构



### 存储器管理

**cpu直接访问物理内存地址（无存储抽象）主要问题：（运行多个程序的需求和程序越来越大的需求）**

1. 内存大小和程序大小的冲突，特别是如果多个程序同时运行在内存中时
2. 运行多个程序，所带来的访问同一物理地址的冲突


1.程序直接使用物理地址，物理地址访问的只是内存，而内存大小有限，所以对于程序大小的限制比较严重。

2.内存中运行多个程序比较困难，不同程序操作的物理地址可能产生冲突，每个程序编译后形成指令代码，指令全是直接操作、访问物理地址。

可能有人问，编译器编译时可以直接在指令代码中指定内存中没有使用的地址啊？但是编译器如何内存地址的使用情况？而且内存的使用是动态变化的？

所以编译器编译出来的指令代码里面的地址应该是相对的，是从0地址开始的虚拟地址，虚拟地址由虚拟存储器解析

#### 解决内存同时运行多个程序问题：地址空间

要保证多个程序处于内存中，且相互不影响，需要解决两个问题：保护和重定位。

比较好的办法是，创造新的内存抽象：地址空间。

地址空间是一个进程可用于寻址内存的一套地址集合。

每个进程都有一个自己的地址空间，并且每个进程地址空间相互独立。

简单的实现可以由基址寄存器和界限寄存器来实现：

例如，一个基址寄存器保存一个程序的物理起始地址，程序内部地址都是从0开始的相对地址，实际cpu访问指令中地址应用到内存中时，会事先将指令地址和基址寄存器中相加再去访问内存。 当然，这只是地址空间的一种简单的实现，更完善的实现见虚拟存储技术。

#### 解决内存不够的问题：交换技术/虚拟存储技术

两种主要策略：

- 交换技术：把一个进程完整调入内存，使运行一段时间，然后存回磁盘
- 虚拟内存技术：该技术能使程序只有一部分被调入内存的情况下运行

显然交换技术，目前并不是很通用，因为可能一个程序的大小都比内存要大，而且交换很大的程序，耗时也是比较大的。

采用较多的虚拟内存技术。


#### 虚拟内存

该技术设计出来就是为了解决上述的两个问题：多个程序同时运行的物理地址冲突(地址空间的实现)和内存大小满足不了多个程序大小。

设计思想：

每个程序拥有自己的地址空间，这个空间被分割成多个块，每一块称做一页或页面。每一页有连续的地址范围。这些页被映射到物理内存，但不是所有的页都必须在内存中才能运行。当程序引用到的一部分在物理内存中的地址空间时，由硬件立刻执行必要的的映射。当程序引用到的一部分不在物理内存中的地址空间时，由操作系统负责将缺失的部分装入物理内存并重新执行失败的指令。

虚拟内存系统使用的分页技术：



#### 虚拟存储器

虚拟存储器是相对物理存储器而言的，物理存储器是指由地址总线直接访问的存储空间，其地址为物理地址；虚拟存储器是指程序使用的逻辑存储空间，比物理存储器大得多，可以运行大型程序。

虚拟存储器机制由主存储器、辅助存储器和存储管理部件共同部件。通过管理软件，达到主存和和辅存的密切配合，使整个存储器具有接近主存的速度和接近辅存的容量。这种技术不断改进完善，就形成了虚拟存储系统。